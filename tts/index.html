<!DOCTYPE html>
<script>
    (function() {
        try {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark-mode');
            }
        } catch (e) { console.error("Error applying initial theme:", e); }
    })();
</script>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="shortcut icon" href="/favicon.ico">
<title>Free AI 文本转音频</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
    --primary-color: #4F46E5;
    --primary-light: #6366F1;
    --primary-dark: #4338CA;
    --secondary-color: #8B5CF6;
    --light-bg: #F8FAFC;
    --card-bg: #ffffff;
    --input-bg: rgba(255, 255, 255, 0.8);
    --input-focus-bg: #ffffff;
    --border-color: #E2E8F0;
    --text-color: #1E293B;
    --text-light: #64748B;
    --success-color: #10B981;
    --error-color: #EF4444;
    --warning-color: #F59E0B;
    --box-shadow: 0 4px 10px rgba(0, 0, 0, 0.04), 0 0 1px rgba(0, 0, 0, 0.1);
    --box-shadow-hover: 0 8px 16px rgba(0, 0, 0, 0.06), 0 0 2px rgba(0, 0, 0, 0.1);
    --kbd-bg: #F1F5F9;
    --divider-color: #E2E8F0;


    --border-radius: 10px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --gradient-primary: linear-gradient(135deg, #4F46E5, #7C3AED);
    --gradient-secondary: linear-gradient(135deg, #8B5CF6, #C084FC);
    --voice-alloy: #4F46E5;
    --voice-echo: #6366F1;
    --voice-fable: #8B5CF6;
    --voice-onyx: #333333; 
    --voice-nova: #10B981;
    --voice-shimmer: #60A5FA;
    --voice-coral: #F87171;
    --voice-verse: #FBBF24;
    --voice-ballad: #A78BFA;
    --voice-ash: #4B5563;
    --voice-sage: #059669;
    --voice-amuch: #F59E0B;
    --voice-dan: #1F2937;
    --voice-hypnosis: #a855f7;
}

html.dark-mode {
    --light-bg: #111827; 
    --card-bg: #1F2937; 
    --input-bg: rgba(31, 41, 55, 0.7);
    --input-focus-bg: #293548;
    --border-color: #374151;
    --text-color: #F3F4F6; 
    --text-light: #9CA3AF;
    --primary-light: #6b72ff; 
    --box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2), 0 0 1px rgba(0, 0, 0, 0.5);
    --box-shadow-hover: 0 8px 16px rgba(0, 0, 0, 0.25), 0 0 2px rgba(0, 0, 0, 0.5);
    --kbd-bg: #374151;
    --divider-color: #374151;
    --voice-onyx: #D1D5DB;
}

* {
box-sizing: border-box;
margin: 0;
padding: 0;
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
}
body {
background-color: var(--light-bg);
color: var(--text-color);
line-height: 1.5;
padding: 0;
margin: 0;
background-image:
radial-gradient(circle at 80% 10%, rgba(124, 58, 237, 0.05) 0%, transparent 600px),
radial-gradient(circle at 20% 90%, rgba(79, 70, 229, 0.05) 0%, transparent 600px);
transition: background-color 0.3s, color 0.3s; 
}
.container {
max-width: 1400px;
margin: 0 auto;
padding: 1.5rem 1rem;
}
header {
padding: 1.5rem 0 2rem;
text-align: center;
position: relative;
}
h1 {
font-size: 2.6rem;
font-weight: 800;
margin-bottom: 0.75rem;
background: var(--gradient-primary);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
display: inline-block;
letter-spacing: -0.02em;
}
.description {
font-size: 1.1rem;
color: var(--text-light);
max-width: 700px;
margin: 0 auto;
line-height: 1.6;
}
.content {
display: flex;
gap: 1.5rem;
margin-top: 1.5rem;
position: relative;
}
.text-input-section, .audio-output-section {
flex: 1;
width: 50%;
}
.card {
background-color: var(--card-bg);
border-radius: var(--border-radius);
box-shadow: var(--box-shadow);
padding: 1.25rem;
margin-bottom: 1.25rem;
transition: var(--transition);
position: relative;
overflow: hidden;
border: 1px solid var(--border-color); 
backdrop-filter: blur(10px);
height: auto;
}
.card:hover {
box-shadow: var(--box-shadow-hover);
transform: translateY(-2px);
}
.section-title {
font-size: 1.25rem;
font-weight: 600;
margin-bottom: 1rem;
color: var(--text-color);
display: flex;
align-items: center;
justify-content: space-between;
}
.section-title i {
margin-right: 0.75rem;
background: var(--gradient-primary);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
font-size: 1.1rem;
}
textarea {
width: 100%;
height: 180px;
padding: 1rem;
border: 1px solid var(--border-color);
border-radius: var(--border-radius);
resize: vertical;
font-size: 1rem;
margin-bottom: 0.5rem;
transition: var(--transition);
background-color: var(--input-bg); 
color: var(--text-color); 
box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.03);
line-height: 1.6;
}
textarea:focus {
outline: none;
border-color: var(--primary-light);
box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
background-color: var(--input-focus-bg); 
}

.voice-style-option label {
display: flex;
flex-direction: column;
align-items: center;
padding: 0.5rem 0.3rem;
border: 2px solid var(--border-color);
border-radius: var(--border-radius);
cursor: pointer;
transition: all 0.2s ease;
background: var(--card-bg); 
text-align: center;
font-size: 0.85rem;
height: 100%;
}
.voice-style-option input[type="radio"]:checked + label {
border-color: var(--primary-color);
background: rgba(99, 102, 241, 0.1); 
box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
}
.shortcut-hint kbd {
background: var(--kbd-bg);
padding: 0.1rem 0.3rem;
border-radius: 3px;
border: 1px solid var(--border-color);
margin: 0 0.2rem;
font-family: monospace;
color: var(--text-color);
}
.divider {
height: 1px;
background: var(--divider-color);
margin: 1.25rem 0;
}
.lang-toggle-container {
position: absolute;
top: 2rem;
right: 2rem;
display: flex;
align-items: center; 
background-color: rgba(255, 255, 255, 0.1); 
backdrop-filter: blur(5px);
border-radius: 8px;
border: 1px solid var(--border-color);
padding: 4px;
z-index: 10;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

html.dark-mode .lang-toggle-container {
    background-color: rgba(31, 41, 55, 0.1); /* Dark mode specific background */
}

.lang-option {
padding: 4px 12px;
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
font-size: 0.9em;
font-weight: 500;
letter-spacing: 0.5px;
color: var(--text-light);
border-radius: 6px;
cursor: pointer;
transition: all 0.3s ease;
}
.lang-option.active {
background: var(--primary-color);
color: #ffffff;
box-shadow: 0 1px 4px rgba(79, 70, 229, 0.3);
}

/* --- [新功能] Dark Mode Toggle Switch Styling --- */
.theme-switch-wrapper {
    display: flex;
    align-items: center;
    margin-left: 8px;
    padding-left: 8px;
    border-left: 1px solid var(--border-color);
}
.theme-switch {
    display: inline-block;
    height: 24px;
    width: 24px;
    position: relative;
    cursor: pointer;
}
.theme-switch i {
    font-size: 16px;
    color: var(--text-light);
    transition: transform 0.4s ease, opacity 0.3s ease;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}
.theme-switch i:hover {
    color: var(--primary-color);
}
#theme-icon-sun {
    opacity: 1;
    transform: translate(-50%, -50%) rotate(0deg);
}
#theme-icon-moon {
    opacity: 0;
    transform: translate(-50%, -50%) rotate(90deg);
}
html.dark-mode #theme-icon-sun {
    opacity: 0;
    transform: translate(-50%, -50%) rotate(-90deg);
}
html.dark-mode #theme-icon-moon {
    opacity: 1;
    transform: translate(-50%, -50%) rotate(0deg);
}


@media (max-width: 1024px) { .content { flex-direction: column; } .text-input-section, .audio-output-section { width: 100%; } }
@media (max-width: 768px) { .container { padding: 1rem 0.8rem; } h1 { font-size: 2rem; } .description { font-size: 1rem; padding: 0 1rem; } .card { padding: 1rem; } textarea { height: 160px; } .lang-toggle-container { top: 1rem !important; right: 1rem !important; } }
#api-token-toggle {
cursor: pointer;
color: var(--text-light);
transition: color 0.3s;
position: relative;
}
#api-token-toggle:hover {
color: var(--primary-color);
}
#api-token-toggle.active {
color: var(--success-color);
}
#api-token-container {
display: none;
padding: 1rem;
background-color: var(--light-bg);
border-radius: var(--border-radius);
margin-bottom: 1rem;
border: 1px solid var(--border-color);
}
#api-token-container p {
font-size: 0.9rem;
color: var(--text-light);
margin-bottom: 0.75rem;
line-height: 1.5;
}
#api-token-container a {
color: var(--primary-color);
text-decoration: none;
font-weight: 500;
}
#api-token-container a:hover {
text-decoration: underline;
}
.input-group {
display: flex;
gap: 0.5rem;
}
#api-token-input {
flex: 1;
padding: 0.6rem 0.8rem;
border: 1px solid var(--border-color);
border-radius: var(--border-radius);
font-size: 0.9rem;
background-color: var(--input-bg);
color: var(--text-color);
}
#api-token-input:focus {
outline: none;
border-color: var(--primary-light);
box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
}
.text-stats {
display: flex;
align-items: center;
margin-bottom: 1rem;
font-size: 0.9rem;
color: var(--text-light);
}
.text-stat {
margin-right: 1.5rem;
display: flex;
align-items: center;
}
.text-stat i {
margin-right: 0.4rem;
color: var(--primary-light);
}
.btn {
display: inline-flex;
align-items: center;
justify-content: center;
background: var(--gradient-primary);
color: white;
border: none;
padding: 0.75rem 1.25rem;
height: 2.75rem;
cursor: pointer;
border-radius: var(--border-radius);
font-size: 1rem;
font-weight: 500;
transition: var(--transition);
box-shadow: 0 2px 6px rgba(79, 70, 229, 0.3);
position: relative;
overflow: hidden;
text-decoration: none; 
}
.btn::after {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(rgba(255,255,255,0.1), rgba(255,255,255,0));
opacity: 0;
transition: opacity 0.3s;
}
.btn:hover::after {
opacity: 1;
}
.btn:active {
transform: translateY(1px);
box-shadow: 0 1px 3px rgba(79, 70, 229, 0.2);
}
.btn:disabled {
cursor: not-allowed;
background: #BDBDBD;
box-shadow: none;
}
.btn-success {
background: linear-gradient(135deg, #10B981, #059669);
box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
}
.btn-text {
background: none;
color: var(--primary-color);
padding: 0;
height: auto;
font-weight: 500;
box-shadow: none;
}
.btn-text:hover {
background: none;
color: var(--primary-dark);
text-decoration: underline;
box-shadow: none;
}
.btn-text::after {
display: none;
}
.btn i {
margin-right: 0.5rem;
}
.btn .spinner {
display: inline-block; width: 1.25rem; height: 1.25rem; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: #ffffff; animation: spin 1s linear infinite; margin-left: 0.6rem;
}
@keyframes spin { to { transform: rotate(360deg); } }
.btn-danger {
background: linear-gradient(135deg, #EF4444, #DC2626);
box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
}
.btn-sm {
padding: 0.4rem 0.8rem;
height: 2.2rem;
font-size: 0.9rem;
}
.voice-style-selector {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
gap: 0.4rem;
margin-bottom: 1.25rem;
}
.voice-style-option {
min-width: 0;
}
.voice-style-option input[type="radio"] {
display: none;
}
.voice-style-icon {
font-size: 1rem;
margin-bottom: 0.2rem;
}
.voice-style-name {
font-weight: 600;
font-size: 0.8rem;
margin-bottom: 0.2rem;
line-height: 1.2;
}
.voice-style-desc {
font-size: 0.7rem;
color: var(--text-light);
line-height: 1.1;
}
.custom-audio-player {
width: 100%;
margin-top: 0.75rem;
border-radius: var(--border-radius);
background: #F1F5F9;
padding: 0.75rem;
box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
}
html.dark-mode .custom-audio-player { background: #111827; }
audio {
width: 100%;
height: 60px;
border-radius: 25px;
}
html.dark-mode audio::-webkit-media-controls-panel {
    background-color: var(--card-bg);
}
html.dark-mode audio::-webkit-media-controls-enclosure {
    background-color: var(--card-bg);
}
html.dark-mode audio::-webkit-media-controls-play-button,
html.dark-mode audio::-webkit-media-controls-current-time-display,
html.dark-mode audio::-webkit-media-controls-time-remaining-display,
html.dark-mode audio::-webkit-media-controls-mute-button,
html.dark-mode audio::-webkit-media-controls-volume-slider,
html.dark-mode audio::-webkit-media-controls-fullscreen-button {
    filter: invert(1) grayscale(1) brightness(1.5);
}

.status {
margin-top: 1rem;
padding: 0.75rem;
border-radius: var(--border-radius);
font-size: 0.95rem;
display: none;
animation: fadeInUp 0.4s ease;
font-weight: 500;
}
@keyframes fadeInUp {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}
.status.success {
background-color: rgba(16, 185, 129, 0.1); color: #6ee7b7; border-left: 3px solid var(--success-color); display: block;
}
.status.error {
background-color: rgba(239, 68, 68, 0.1); color: #f87171; display: block; border-left: 3px solid var(--error-color);
}
.status.warning {
background-color: rgba(245, 158, 11, 0.1); color: #fbbf24; display: block; border-left: 3px solid var(--warning-color);
}
html.dark-mode .status.success { color: #6ee7b7; }
html.dark-mode .status.error { color: #f87171; }
html.dark-mode .status.warning { color: #fbbf24; }
.loading {
display: none; align-items: center; margin: 1rem 0; font-size: 0.95rem; color: var(--text-light);
}
.history-section { margin-top: 1.25rem; }
.history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
.history-warning { background-color: rgba(250, 204, 21, 0.1); border-left: 3px solid #FACC15; padding: 0.6rem 0.75rem; margin-bottom: 1rem; border-radius: var(--border-radius); font-size: 0.9rem; color: #854D0E; display: flex; align-items: center;}
html.dark-mode .history-warning { color: #fcd34d; }
.history-warning i { margin-right: 0.5rem; color: #EAB308; }
.history-container { max-height: 350px; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--primary-light) var(--light-bg); }
.history-container::-webkit-scrollbar { width: 6px; }
.history-container::-webkit-scrollbar-track { background: var(--light-bg); border-radius: 10px; }
.history-container::-webkit-scrollbar-thumb { background-color: var(--primary-light); border-radius: 10px; }
.history-item { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 0.5rem; border-bottom: 1px solid var(--border-color); transition: var(--transition); border-radius: 0.5rem; }
.history-item:hover { background-color: rgba(99, 102, 241, 0.08); }
.history-item:last-child { border-bottom: none; }
.history-info { flex: 1; min-width: 0; padding-right: 1rem; }
.history-timestamp { font-size: 0.8rem; color: var(--text-light); margin-bottom: 0.3rem; }
.history-voice { font-size: 0.95rem; font-weight: 600; display: flex; align-items: center; color: var(--primary-light); margin-bottom: 0.2rem; } 
.history-voice::before { content: ''; display: inline-block; width: 0.5rem; height: 0.5rem; background: var(--gradient-primary); border-radius: 50%; margin-right: 0.5rem; }
.history-text { font-size: 0.9rem; color: var(--text-light); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; }
.no-history { color: var(--text-light); font-size: 0.95rem; text-align: center; padding: 1.5rem 0; }
footer { text-align: center; padding: 2rem 0 1.5rem; color: var(--text-light); font-size: 0.9rem; opacity: 0.8; }
footer i { color: var(--primary-light); }
.features-card { margin-top: 1.5rem; background: var(--card-bg); border-radius: var(--border-radius); padding: 1.25rem; box-shadow: var(--box-shadow); border: 1px solid var(--border-color); }
.features-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--text-color); text-align: center; }
.features-list { list-style-type: none; padding: 0; margin: 0; }
.feature-item { display: flex; align-items: flex-start; margin-bottom: 0.6rem; padding-bottom: 0.6rem; border-bottom: 1px solid var(--border-color); }
.feature-item:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
.feature-icon { flex-shrink: 0; width: 24px; height: 24px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.8rem; margin-top: 0.2rem; }
.feature-icon i { font-size: 0.8rem; color: white; }
.feature-text { font-size: 0.95rem; color: var(--text-color); line-height: 1.5; }
.history-item.new { animation: highlight 2s ease; }
@keyframes highlight { 0% { background-color: rgba(99, 102, 241, 0.15); } 100% { background-color: transparent; } }
.badge { display: inline-flex; align-items: center; padding: 0.25rem 0.6rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; margin-left: 0.5rem; background: var(--gradient-secondary); color: white; opacity: 0.9; }
.preview-container { background: var(--light-bg); border-radius: 15px; padding: 1.5rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); margin-bottom: 1.25rem; position: relative; overflow: hidden; min-height: 250px; display: flex; flex-direction: column; }
.preview-header { display: flex; align-items: center; margin-bottom: 1.25rem; }
.preview-title { font-size: 1.2rem; font-weight: 600; margin: 0; display: flex; align-items: center; }
.preview-title i { margin-right: 0.75rem; font-size: 1.4rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.preview-icon { position: absolute; right: -15px; top: -15px; width: 80px; height: 80px; opacity: 0.05; transform: rotate(15deg); color: var(--primary-color); }
.preview-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1; color: var(--text-light); border: 2px dashed var(--border-color); border-radius: 10px; font-size: 0.95rem; }
.preview-placeholder i { margin-bottom: 0.75rem; font-size: 2.2rem; opacity: 0.5; }
.shortcut-hint { display: inline-flex; align-items: center; margin-left: 0.75rem; font-size: 0.8rem; color: var(--text-light); vertical-align: middle; }
.usage-tips { background: linear-gradient(to right, rgba(250, 245, 255, 0.05), rgba(245, 243, 255, 0.05)); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 1rem; margin-top: 1.25rem; }
html.light-mode .usage-tips { background: linear-gradient(to right, #faf5ff, #f5f3ff); border: 1px solid transparent; }
.tips-title { font-size: 1rem; font-weight: 600; margin-bottom: 0.6rem; display: flex; align-items: center; }
.tips-title i { margin-right: 0.5rem; color: var(--secondary-color); }
.tips-list { list-style: none; padding: 0; margin: 0; }
.tips-list li { display: flex; align-items: baseline; margin-bottom: 0.4rem; font-size: 0.9rem; color: var(--text-color); }
.tips-list li::before { content: "•"; color: var(--secondary-color); font-weight: bold; margin-right: 0.5rem; }
.current-voice-info { display: flex; align-items: center; margin-bottom: 0.75rem; background: rgba(31, 41, 55, 0.2); padding: 0.6rem 0.75rem; border-radius: 8px; }
html.light-mode .current-voice-info { background: rgba(255, 255, 255, 0.7); }
.current-voice-icon { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.6rem; color: white; }
.current-voice-details { flex: 1; }
.current-voice-name { font-weight: 600; font-size: 1rem; margin-bottom: 0.1rem; }
.current-voice-desc { font-size: 0.8rem; color: var(--text-light); }
.input-section-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.75rem; display: flex; align-items: center; }
.input-section-title i { margin-right: 0.5rem; color: var(--primary-color); }

</style>
</head>
<body>
<div class="container">
<header>
<div class="lang-toggle-container">
    <div class="lang-option" id="lang-zh">中</div>
    <div class="lang-option" id="lang-en">EN</div>
    <div class="theme-switch-wrapper">
        <div class="theme-switch" id="theme-toggle" title="切换亮色/暗色模式">
            <i class="fas fa-sun" id="theme-icon-sun"></i>
            <i class="fas fa-moon" id="theme-icon-moon"></i>
        </div>
    </div>
</div>
<!-- ... The rest of your HTML is unchanged ... -->
<h1 data-lang-zh="Free AI 文本转音频" data-lang-en="Free AI Text-to-Speech">Free AI 文本转音频</h1>
<p class="description">
<span data-lang-zh="输入文本，选择语音风格，一键将文字转换为自然流畅的语音。" data-lang-en="Enter text, choose a voice style, and convert text into natural, fluent speech with one click.">输入文本，选择语音风格，一键将文字转换为自然流畅的语音。</span><br>
<span data-lang-zh="支持多种声音特征，帮您创建专业水准的音频内容。" data-lang-en="Supports various voice characteristics to help you create professional-level audio content.">支持多种声音特征，帮您创建专业水准的音频内容。</span>
</p>
<br>
<a href="https://freeai.aihub.ren" class="btn" style="text-decoration: none;">
<span data-lang-zh="返回首页" data-lang-en="Homepage">返回首页</span>
</a>
</header>
<div class="content">
<section class="text-input-section">
<div class="card">
<h2 class="section-title">
    <div><i class="fas fa-microphone-alt"></i><span data-lang-zh="语音生成" data-lang-en="Speech Generation">语音生成</span></div>
    <i class="fas fa-key" id="api-token-toggle" title="设置API Token"></i>
</h2>
<div id="api-token-container">
    <p data-lang-zh="此服务需要使用Pollinations AI的API Token。请前往官网获取免费的'seed'等级Token，然后粘贴到下方。" data-lang-en="This service requires an API Token from Pollinations AI. Please visit their official website to get a free 'seed' tier token, then paste it below.">此服务需要使用Pollinations AI的API Token。请前往官网获取免费的'seed'等级Token，然后粘贴到下方。</p>
    <p><a href="https://auth.pollinations.ai" target="_blank">https://auth.pollinations.ai</a></p>
    <div class="input-group">
        <input type="password" id="api-token-input" placeholder="Enter your API Token here">
        <button id="save-token-btn" class="btn btn-sm"><i class="fas fa-save"></i> <span data-lang-zh="保存" data-lang-en="Save">保存</span></button>
    </div>
</div>
<div class="input-section-title"><i class="fas fa-sliders"></i><span data-lang-zh="选择语音风格" data-lang-en="Select Voice Style">选择语音风格</span></div>
<p style="margin-bottom: 0.75rem; font-size: 0.95rem; color: var(--text-light);">
<span data-lang-zh="每种风格都有其独特的音色和表现力，选择最适合您内容的声音" data-lang-en="Each style has its unique tone and expression, choose the most suitable voice for your content">每种风格都有其独特的音色和表现力，选择最适合您内容的声音</span>
</p>
<div class="voice-style-selector">
<div class="voice-style-option">
<input type="radio" id="voice-alloy" name="voiceStyle" value="openai-audio" data-voice="alloy" checked>
<label for="voice-alloy">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-alloy);"></i></span>
<span class="voice-style-name">Alloy</span><span class="voice-style-desc" data-lang-zh="平衡中性" data-lang-en="Balanced"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-echo" name="voiceStyle" value="openai-audio" data-voice="echo">
<label for="voice-echo">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-echo);"></i></span>
<span class="voice-style-name">Echo</span><span class="voice-style-desc" data-lang-zh="深沉有力" data-lang-en="Deep"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-fable" name="voiceStyle" value="openai-audio" data-voice="fable">
<label for="voice-fable">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-fable);"></i></span>
<span class="voice-style-name">Fable</span><span class="voice-style-desc" data-lang-zh="温暖讲述" data-lang-en="Narrative"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-onyx" name="voiceStyle" value="openai-audio" data-voice="onyx">
<label for="voice-onyx">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-onyx);"></i></span>
<span class="voice-style-name">Onyx</span><span class="voice-style-desc" data-lang-zh="威严庄重" data-lang-en="Authoritative"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-nova" name="voiceStyle" value="openai-audio" data-voice="nova">
<label for="voice-nova">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-nova);"></i></span>
<span class="voice-style-name">Nova</span><span class="voice-style-desc" data-lang-zh="友好专业" data-lang-en="Friendly"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-shimmer" name="voiceStyle" value="openai-audio" data-voice="shimmer">
<label for="voice-shimmer">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-shimmer);"></i></span>
<span class="voice-style-name">Shimmer</span><span class="voice-style-desc" data-lang-zh="轻快明亮" data-lang-en="Bright"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-coral" name="voiceStyle" value="openai-audio" data-voice="coral">
<label for="voice-coral">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-coral);"></i></span>
<span class="voice-style-name">Coral</span><span class="voice-style-desc" data-lang-zh="温柔平静" data-lang-en="Gentle"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-verse" name="voiceStyle" value="openai-audio" data-voice="verse">
<label for="voice-verse">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-verse);"></i></span>
<span class="voice-style-name">Verse</span><span class="voice-style-desc" data-lang-zh="生动诗意" data-lang-en="Lively"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-ballad" name="voiceStyle" value="openai-audio" data-voice="ballad">
<label for="voice-ballad">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-ballad);"></i></span>
<span class="voice-style-name">Ballad</span><span class="voice-style-desc" data-lang-zh="抒情柔和" data-lang-en="Melodious"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-ash" name="voiceStyle" value="openai-audio" data-voice="ash">
<label for="voice-ash">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-ash);"></i></span>
<span class="voice-style-name">Ash</span><span class="voice-style-desc" data-lang-zh="思考沉稳" data-lang-en="Thoughtful"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-sage" name="voiceStyle" value="openai-audio" data-voice="sage">
<label for="voice-sage">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-sage);"></i></span>
<span class="voice-style-name">Sage</span><span class="voice-style-desc" data-lang-zh="智慧老练" data-lang-en="Wise"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-amuch" name="voiceStyle" value="openai-audio" data-voice="amuch">
<label for="voice-amuch">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-amuch);"></i></span>
<span class="voice-style-name">Amuch</span><span class="voice-style-desc" data-lang-zh="饱满自然" data-lang-en="Full-bodied"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-dan" name="voiceStyle" value="openai-audio" data-voice="dan">
<label for="voice-dan">
<span class="voice-style-icon"><i class="fas fa-microphone" style="color: var(--voice-dan);"></i></span>
<span class="voice-style-name">Dan</span><span class="voice-style-desc" data-lang-zh="男声稳重" data-lang-en="Steady Male"></span>
</label>
</div>
<div class="voice-style-option">
<input type="radio" id="voice-hypnosis" name="voiceStyle" value="hypnosis-tracy">
<label for="voice-hypnosis">
<span class="voice-style-icon"><i class="fas fa-magic" style="color: var(--voice-hypnosis);"></i></span>
<span class="voice-style-name">Hypnosis</span>
<span class="voice-style-desc" data-lang-zh="催眠疗愈" data-lang-en="Hypnotic">催眠疗愈</span>
</label>
</div>
</div>
<div class="divider"></div>
<div class="input-section-title"><i class="fas fa-pen-fancy"></i><span data-lang-zh="输入文本" data-lang-en="Enter Text">输入文本</span></div>
<textarea id="textInput" data-lang-placeholder-zh="使用ai回复生成对话。如需让AI照着念，可以在文本之前加上：请照着文本念" data-lang-placeholder-en="Use AI to generate dialogue. To have the AI read the text as is, prefix it with: Please read the following text"></textarea>
<div class="text-stats">
<div class="text-stat"><i class="fas fa-text-height"></i><span id="charCount"></span></div>
<div class="text-stat"><i class="fas fa-clock"></i><span id="durationEstimate"></span></div>
</div>
<div style="display: flex; align-items: center;">
<button id="generateBtn" class="btn">
    <span id="generateBtnContent">
        <i class="fas fa-play"></i>
        <span id="generateBtnText" data-lang-zh="生成语音" data-lang-en="Generate Speech"></span>
    </span>
    <span id="generateBtnSpinner" class="spinner" style="display: none;"></span>
</button>
<div class="shortcut-hint"><span data-lang-zh="快捷键: " data-lang-en="Shortcut: "></span><kbd>Ctrl</kbd> + <kbd>Enter</kbd></div>
</div>
</div>
<div class="usage-tips">
<div class="tips-title"><i class="fas fa-lightbulb"></i><span data-lang-zh="使用小技巧" data-lang-en="Usage Tips">使用小技巧</span></div>
<ul class="tips-list">
    <li><span data-lang-zh="输入标点符号可增加语音的自然停顿和语调变化" data-lang-en="Using punctuation adds natural pauses and intonation changes to the speech"></span></li>
    <li><span data-lang-zh="不同语音风格适合不同场景，可以尝试多种风格找到最适合的" data-lang-en="Different voice styles suit different scenarios; try various styles to find the best fit"></span></li>
    <li><span data-lang-zh="大段文本可划分为多个段落，生成后再合并，效果更佳" data-lang-en="For long texts, splitting into paragraphs and merging after generation yields better results"></span></li>
    <li><span data-lang-zh="特殊专业术语可能需要加注音或替换为更通用的表达" data-lang-en="Specialized terms may need phonetic spelling or replacement with more common expressions"></span></li>
</ul>
</div>
</section>
<section class="audio-output-section">
<div class="card">
<div class="preview-container">
<div class="preview-icon"><i class="fas fa-headphones-alt fa-5x"></i></div>
<div class="preview-header"><h3 class="preview-title"><i class="fas fa-play-circle"></i><span data-lang-zh="音频预览" data-lang-en="Audio Preview"></span></h3></div>
<div id="currentVoiceContainer" style="display: none;" class="current-voice-info">
<div class="current-voice-icon" id="currentVoiceIcon"><i class="fas fa-microphone"></i></div>
<div class="current-voice-details"><div class="current-voice-name" id="currentVoiceName"></div><div class="current-voice-desc" id="currentVoiceDesc"></div></div>
</div>
<div id="audioContainer" style="flex: 1; display: flex; flex-direction: column; justify-content: center;">
<div class="preview-placeholder" id="noAudioMessage"><i class="fas fa-music"></i><span data-lang-zh="尚未生成语音" data-lang-en="No audio generated yet"></span></div>
</div>
</div>
<div id="downloadContainer" style="display: none;">
<button id="downloadBtn" class="btn btn-success"><i class="fas fa-download"></i><span data-lang-zh="下载音频文件" data-lang-en="Download Audio File"></span></button>
</div>
<div class="loading" id="loadingIndicator"><span class="spinner"></span> <span data-lang-zh="正在生成语音..." data-lang-en="Generating audio..."></span></div>
<div id="statusMessage" class="status"></div>
</div>
<div class="card history-section">
<div class="history-header">
<h2 class="section-title"><i class="fas fa-history"></i><span data-lang-zh="历史记录" data-lang-en="History"></span><span class="badge" data-lang-zh="最近10条" data-lang-en="Last 10"></span></h2>
<button id="clearHistoryBtn" class="btn btn-sm btn-danger"><i class="fas fa-trash"></i><span data-lang-zh="清空记录" data-lang-en="Clear History"></span></button>
</div>
<div class="history-warning"><i class="fas fa-exclamation-triangle"></i><span data-lang-zh="生成记录链接刷新后重置，请注意下载" data-lang-en="History links reset on refresh. Please download your files."></span></div>
<div class="history-container" id="historyContainer"><div id="historyList"><p class="no-history" data-lang-zh="暂无历史记录" data-lang-en="No history records"></p></div></div>
</div>
</section>
</div>
<footer>
<p>© 2025 <a href="https://other.azad.asia" target="_blank" style="text-decoration: none; color: inherit;">Azad的实验室</a> | 基于 Pollinations.AI | <i class="fas fa-sparkles"></i><a href="https://home.azad.asia/dashang" target="_blank" style="text-decoration: none; color: inherit;" data-lang-zh="请站长喝咖啡" data-lang-en="Buy me a coffee"></a></p>
</footer>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
const textInput = document.getElementById('textInput');
const generateBtn = document.getElementById('generateBtn');
const generateBtnContent = document.getElementById('generateBtnContent');
const generateBtnText = document.getElementById('generateBtnText');
const generateBtnSpinner = document.getElementById('generateBtnSpinner');
const downloadBtn = document.getElementById('downloadBtn');
const audioContainer = document.getElementById('audioContainer');
const noAudioMessage = document.getElementById('noAudioMessage');
const downloadContainer = document.getElementById('downloadContainer');
const loadingIndicator = document.getElementById('loadingIndicator');
const statusMessage = document.getElementById('statusMessage');
const historyList = document.getElementById('historyList');
const charCount = document.getElementById('charCount');
const durationEstimate = document.getElementById('durationEstimate');
const clearHistoryBtn = document.getElementById('clearHistoryBtn');
const currentVoiceContainer = document.getElementById('currentVoiceContainer');
const currentVoiceIcon = document.getElementById('currentVoiceIcon');
const currentVoiceName = document.getElementById('currentVoiceName');
const currentVoiceDesc = document.getElementById('currentVoiceDesc');
const langZhOption = document.getElementById('lang-zh');
const langEnOption = document.getElementById('lang-en');
const apiTokenToggle = document.getElementById('api-token-toggle');
const apiTokenContainer = document.getElementById('api-token-container');
const apiTokenInput = document.getElementById('api-token-input');
const saveTokenBtn = document.getElementById('save-token-btn');
const themeToggle = document.getElementById('theme-toggle'); 

const MAX_HISTORY_ITEMS = 10;
const CHARS_PER_MINUTE = 150;
const voiceDescriptions = {
    'alloy': { zh: '平衡中性', en: 'Balanced' }, 'echo': { zh: '深沉有力', en: 'Deep' }, 'fable': { zh: '温暖讲述', en: 'Narrative' },
    'onyx': { zh: '威严庄重', en: 'Authoritative' }, 'nova': { zh: '友好专业', en: 'Friendly' }, 'shimmer': { zh: '轻快明亮', en: 'Bright' },
    'coral': { zh: '温柔平静', en: 'Gentle' }, 'verse': { zh: '生动诗意', en: 'Lively' }, 'ballad': { zh: '抒情柔和', en: 'Melodious' },
    'ash': { zh: '思考沉稳', en: 'Thoughtful' }, 'sage': { zh: '智慧老练', en: 'Wise' }, 'amuch': { zh: '饱满自然', en: 'Full-bodied' },
    'dan': { zh: '男声稳重', en: 'Steady Male' }, 'hypnosis-tracy': { zh: '催眠疗愈', en: 'Hypnotic' },
};
const voiceColors = { 
    'alloy': '#4F46E5', 'echo': '#6366F1', 'fable': '#8B5CF6', 'onyx': '#333333', 'nova': '#10B981', 'shimmer': '#60A5FA',
    'coral': '#F87171', 'verse': '#FBBF24', 'ballad': '#A78BFA', 'ash': '#4B5563', 'sage': '#059669', 'amuch': '#F59E0B',
    'dan': '#1F2937', 'hypnosis-tracy': '#a855f7'
};
let audioBlob = null;
let history = [];

function applyTheme(theme) {
    if (theme === 'dark') {
        document.documentElement.classList.add('dark-mode');
        document.documentElement.classList.remove('light-mode');
        localStorage.setItem('theme', 'dark');
    } else {
        document.documentElement.classList.remove('dark-mode');
        document.documentElement.classList.add('light-mode');
        localStorage.setItem('theme', 'light');
    }
}
themeToggle.addEventListener('click', () => {
    const isDarkMode = document.documentElement.classList.contains('dark-mode');
    applyTheme(isDarkMode ? 'light' : 'dark');
});

function setLanguage(lang, isInitial = false) {
    const targetLang = lang === 'en' ? 'en' : 'zh';
    document.documentElement.lang = targetLang === 'en' ? 'en' : 'zh-CN';
    if (!isInitial) {
        localStorage.setItem('preferredLanguage', document.documentElement.lang);
    }
    
    langEnOption.classList.toggle('active', targetLang === 'en');
    langZhOption.classList.toggle('active', targetLang === 'zh');
    document.querySelectorAll('[data-lang-zh], [data-lang-en]').forEach(el => {
        const text = el.getAttribute(`data-lang-${targetLang}`);
        if(text !== null) el.textContent = text;
    });
    document.querySelectorAll('[data-lang-placeholder-zh], [data-lang-placeholder-en]').forEach(el => {
        const placeholder = el.getAttribute(`data-lang-placeholder-${targetLang}`);
        if(placeholder !== null) el.setAttribute('placeholder', placeholder);
    });
    updateTextStats();
    updateHistoryUI();
}
function updateTextStats() {
    const text = textInput.value.trim();
    const count = text.length;
    const lang = document.documentElement.lang.startsWith('zh') ? 'zh' : 'en';
    charCount.textContent = lang === 'en' ? `Characters: ${count}` : `字符数: ${count}`;
    const durationSeconds = Math.max(0, Math.round((count / CHARS_PER_MINUTE) * 60));
    durationEstimate.textContent = lang === 'en' ? `Est. Duration: ${durationSeconds} sec` : `估计时长: ${durationSeconds} 秒`;
}
function setButtonState(state) {
    const lang = document.documentElement.lang.startsWith('zh') ? 'zh' : 'en';
    if (state === 'loading') {
        generateBtn.disabled = true;
        generateBtnContent.style.display = 'none';
        generateBtnText.textContent = lang === 'en' ? 'Generating...' : '正在生成...';
        generateBtnSpinner.style.display = 'inline-block';
    } else { 
        generateBtn.disabled = false;
        generateBtnContent.style.display = 'inline-flex';
        generateBtnSpinner.style.display = 'none';
        const currentText = generateBtnText.getAttribute(`data-lang-${lang}`);
        if (currentText) generateBtnText.textContent = currentText;
    }
}
async function generateAudio() {
    const text = textInput.value.trim();
    const selectedOption = document.querySelector('.voice-style-option input[type="radio"]:checked');
    const apiToken = localStorage.getItem('pollinationsApiToken');
    const lang = document.documentElement.lang.startsWith('zh') ? 'zh' : 'en';
    if (!apiToken) {
        showStatus(lang === 'en' ? 'API Token is not set. Please set your token first.' : 'API Token未设置，请先点击右上角的钥匙图标进行设置。', 'warning');
        apiTokenContainer.style.display = 'block';
        return;
    }
    if (!text) {
        showStatus(lang === 'en' ? 'Please enter some text.' : '请输入文本内容', 'error');
        return;
    }
    setButtonState('loading');
    statusMessage.style.display = 'none';
    loadingIndicator.style.display = 'flex';
    try {
        const model = selectedOption.value;
        const voice = selectedOption.dataset.voice;
        let url = `https://text.pollinations.ai/${encodeURIComponent(text)}?model=${model}&token=${apiToken}`;
        if (voice) {
            url += `&voice=${voice}`;
        }
        
        const response = await fetch(url);
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({ error: `${response.status} ${response.statusText}` }));
            throw new Error(errorData.error);
        }
        
        audioBlob = await response.blob();
        if (audioBlob.type !== 'audio/mpeg') {
            throw new Error(lang === 'en' ? 'Invalid audio file received.' : '收到无效的音频文件。');
        }
        const audioUrl = URL.createObjectURL(audioBlob);
        const audioElement = document.createElement('audio');
        audioElement.id = 'audioElement';
        audioElement.controls = true;
        audioElement.autoplay = true;
        audioElement.src = audioUrl;
        
        audioContainer.innerHTML = '';
        audioContainer.appendChild(audioElement);
        noAudioMessage.style.display = 'none';
        downloadContainer.style.display = 'block';
        updateCurrentVoiceDisplay(voice || model);
        addHistoryItem(text, voice || model, audioBlob);
        showStatus(lang === 'en' ? 'Audio generated successfully!' : '语音生成成功！', 'success');
        
    } catch (error) {
        console.error('Error generating audio:', error);
        showStatus(`${lang === 'en' ? 'Error: ' : '错误: '}${error.message}`, 'error');
    } finally {
        setButtonState('idle'); 
        loadingIndicator.style.display = 'none';
    }
}
function updateCurrentVoiceDisplay(voiceOrModel) {
    const lang = document.documentElement.lang.startsWith('zh') ? 'zh' : 'en';
    const voiceName = voiceOrModel.charAt(0).toUpperCase() + voiceOrModel.slice(1).replace('-tracy', ' Tracy');
    const voiceDesc = voiceDescriptions[voiceOrModel] ? (lang === 'en' ? voiceDescriptions[voiceOrModel].en : voiceDescriptions[voiceOrModel].zh) : '';
    const voiceColor = voiceColors[voiceOrModel.replace(' ', '-').toLowerCase()] || '#4F46E5';
    currentVoiceName.textContent = voiceName;
    currentVoiceDesc.textContent = voiceDesc;
    currentVoiceIcon.style.backgroundColor = voiceColor;
    currentVoiceContainer.style.display = 'flex';
}
function downloadAudio(blob, filename) {
    const lang = document.documentElement.lang.startsWith('zh') ? 'zh' : 'en';
    if (!blob) {
        showStatus(lang === 'en' ? 'No audio to download.' : '没有可下载的音频', 'error');
        return;
    }
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename || `audio_${Date.now()}.mp3`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(a.href);
}
function addHistoryItem(text, voice, blob) {
    const previewText = text.substring(0, 30) + (text.length > 30 ? '...' : '');
    const historyItem = { id: Date.now(), timestamp: new Date(), voice: voice, text: text, previewText: previewText, blob: blob };
    history.unshift(historyItem);
    if (history.length > MAX_HISTORY_ITEMS) history.pop();
    saveHistory();
    updateHistoryUI(historyItem.id);
}
function downloadHistoryItem(id) {
    const lang = document.documentElement.lang.startsWith('zh') ? 'zh' : 'en';
    const item = history.find(h => h.id === id);
    if (item && item.blob) {
        const sanitizedText = item.previewText.replace(/[^\w\u4e00-\u9fa5]/g, '');
        downloadAudio(item.blob, `${item.voice}_${sanitizedText}.mp3`);
    } else {
        showStatus(lang === 'en' ? 'Cannot download, audio data is missing. Please regenerate.' : '无法下载，音频数据已丢失，请重新生成。', 'error');
    }
}
function updateHistoryUI(newItemId) {
    const lang = document.documentElement.lang.startsWith('zh') ? 'zh' : 'en';
    if (history.length === 0) {
        const noHistoryText = lang === 'en' ? 'No history records' : '暂无历史记录';
        historyList.innerHTML = `<p class="no-history" data-lang-zh="暂无历史记录" data-lang-en="No history records">${noHistoryText}</p>`;
        return;
    }
    historyList.innerHTML = '';
    history.forEach(item => {
        const historyItemEl = document.createElement('div');
        historyItemEl.className = 'history-item' + (item.id === newItemId ? ' new' : '');
        const date = new Date(item.timestamp);
        const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
        const downloadText = lang === 'en' ? 'Download' : '下载';
        historyItemEl.innerHTML = `
            <div class="history-info">
                <div class="history-timestamp">${formattedDate}</div>
                <div class="history-voice" style="--voice-color: ${voiceColors[item.voice] || '#4F46E5'};">${item.voice}</div>
                <div class="history-text">${item.previewText}</div>
            </div>
            <button class="btn btn-text history-download" data-id="${item.id}">
                <i class="fas fa-download"></i> <span data-lang-zh="下载" data-lang-en="Download">${downloadText}</span>
            </button>`;
        historyList.appendChild(historyItemEl);
    });
    document.querySelectorAll('.history-download').forEach(btn => btn.addEventListener('click', e => downloadHistoryItem(parseInt(e.currentTarget.dataset.id))));
}
function clearHistory() {
    const lang = document.documentElement.lang.startsWith('zh') ? 'zh' : 'en';
    const confirmMessage = lang === 'en' ? 'Are you sure you want to clear all history? This action cannot be undone.' : '确定要清空所有历史记录吗？这个操作不可撤销。';
    if (confirm(confirmMessage)) {
        history = [];
        localStorage.removeItem('audioGeneratorHistory');
        updateHistoryUI();
        showStatus(lang === 'en' ? 'History cleared.' : '历史记录已清空', 'success');
    }
}
function saveHistory() {
    localStorage.setItem('audioGeneratorHistory', JSON.stringify(history.map(item => ({...item, blob: null }))));
}
function loadHistory() {
    const savedHistory = localStorage.getItem('audioGeneratorHistory');
    if (savedHistory) {
      try { 
        history = JSON.parse(savedHistory).map(item => ({...item, timestamp: new Date(item.timestamp), blob: null }));
      } catch (e) {
        console.error("Could not parse history, resetting.", e);
        localStorage.removeItem('audioGeneratorHistory');
       }
    }
}
function showStatus(message, type) {
    statusMessage.textContent = message;
    statusMessage.className = `status ${type}`;
    setTimeout(() => { statusMessage.className = 'status'; }, 6000);
}
apiTokenToggle.addEventListener('click', () => {
    apiTokenContainer.style.display = apiTokenContainer.style.display === 'block' ? 'none' : 'block';
});
saveTokenBtn.addEventListener('click', () => {
    const lang = document.documentElement.lang.startsWith('zh') ? 'zh' : 'en';
    const token = apiTokenInput.value.trim();
    if (token) {
        localStorage.setItem('pollinationsApiToken', token);
        showStatus(lang === 'en' ? 'API Token saved successfully!' : 'API Token 保存成功！', 'success');
        apiTokenContainer.style.display = 'none';
        apiTokenToggle.classList.add('active');
        apiTokenInput.value = ''; 
    } else {
        localStorage.removeItem('pollinationsApiToken');
        showStatus(lang === 'en' ? 'API Token removed.' : 'API Token 已移除。', 'warning');
        apiTokenToggle.classList.remove('active');
    }
});
generateBtn.addEventListener('click', generateAudio);
downloadBtn.addEventListener('click', () => {
    if (audioBlob) {
        const selectedOption = document.querySelector('.voice-style-option input[type="radio"]:checked');
        const voice = selectedOption.dataset.voice || selectedOption.value;
        const text = textInput.value.trim().substring(0, 20).replace(/[^\w\u4e00-\u9fa5]/g, '');
        downloadAudio(audioBlob, `${voice}_${text}.mp3`);
    }
});
textInput.addEventListener('keydown', e => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        generateAudio();
    }
});
textInput.addEventListener('input', updateTextStats);
clearHistoryBtn.addEventListener('click', clearHistory);
langZhOption.addEventListener('click', () => setLanguage('zh'));
langEnOption.addEventListener('click', () => setLanguage('en'));
(function init() {
    loadHistory();
    const preferredLanguage = localStorage.getItem('preferredLanguage') || (navigator.language.startsWith('zh') ? 'zh-CN' : 'en');
    setLanguage(preferredLanguage, true); // Pass true to avoid saving
    
    const savedToken = localStorage.getItem('pollinationsApiToken');
    if (savedToken) {
        apiTokenToggle.classList.add('active');
    }
    updateTextStats();
    updateHistoryUI();
})();
});
</script>
</body>
</html>
